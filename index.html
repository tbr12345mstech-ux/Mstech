<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MSTECH ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€ - ìµœì¢…</title>
<!-- Quagga2 (ë°”ì½”ë“œ) & Tesseract (OCR) CDN -->
<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>
<script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
<style>
  :root{
    --bg:#0f1115;--card:#151924;--ink:#e8eef7;--muted:#9db0c9;--accent:#28dec4;--accent-ink:#0b2530;
    --danger:#ff5d6c;--ok:#56e39f;--yellow:#ffd166;--border:#202637
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale
  }
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  h1{font-size:28px;margin:0 0 18px;letter-spacing:.2px}
  .brand{font-weight:800}
  .grid{display:grid;gap:14px}
  .card{
    background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 14px 16px
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button, .btn{
    background:var(--accent);color:#012; border:0;border-radius:12px;padding:12px 16px;
    font-weight:700;cursor:pointer;transition:.15s;display:inline-flex;gap:8px;align-items:center
  }
  button.secondary{background:#213043;color:var(--ink)}
  button.ghost{background:#111826;border:1px solid var(--border);color:var(--ink)}
  button:disabled{opacity:.55;cursor:not-allowed}
  input[type="text"],input[type="number"],textarea{
    width:100%;background:#0b1220;border:1px solid var(--border);border-radius:12px;
    padding:12px 12px;color:var(--ink);font-size:15px;outline:none
  }
  textarea{min-height:120px;resize:vertical}
  .help{color:var(--muted);font-size:13px}
  .pill{display:inline-block;background:#0e1b2a;border:1px solid var(--border);color:var(--ink);padding:6px 10px;border-radius:999px;font-size:13px;margin:4px 6px 0 0}
  .preview{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid var(--border)}
  video,canvas,.imgprev{width:100%;height:100%;object-fit:cover;display:block}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:8px;margin-top:8px}
  .kv .k{color:var(--muted)}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{background:#0e1a28;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
  .copy{background:#0e1a28;border:1px dashed var(--border);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
  .ok{color:var(--ok)} .bad{color:var(--danger)} .warn{color:var(--yellow)}
</style>
</head>
<body>
  <div class="wrap">
    <h1><span class="brand">MSTECH</span> ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€</h1>

    <!-- 1) ë¼ì´ë¸Œ ì¹´ë©”ë¼ ë°”ì½”ë“œ ìŠ¤ìº” -->
    <section class="card grid">
      <div class="row">
        <button id="btnStart"><span>ğŸ“·</span> ì¹´ë©”ë¼ ìŠ¤ìº” ì‹œì‘</button>
        <button class="secondary" id="btnStop">ì •ì§€</button>
        <span class="help" id="camHint">ë°”ì½”ë“œë¥¼ ê°€ë¡œë¡œ ì¤‘ì•™ì— ë‘ê³  20â€“30cm ê±°ë¦¬ì—ì„œ ì ê¹ ê³ ì •</span>
      </div>
      <div class="preview"><video id="video" autoplay playsinline muted></video></div>

      <div class="grid">
        <label>ë°”ì½”ë“œ</label>
        <div class="row" style="gap:8px">
          <input id="outBarcode" class="mono" placeholder="ë°”ì½”ë“œ ìë™ ì…ë ¥" />
          <button class="ghost" id="copyBarcode">ë³µì‚¬</button>
        </div>
        <small class="help" id="statusCam">ëŒ€ê¸° ì¤‘â€¦</small>
      </div>
    </section>

    <!-- 2) ì‚¬ì§„ ì—…ë¡œë“œ/ì´¬ì˜ + ì´ë¯¸ì§€ ê¸°ë°˜ ì¸ì‹(ë°”ì½”ë“œ & OCR & ìƒ‰ìƒ)  -->
    <section class="card grid">
      <div class="row">
        <input type="file" id="imgFile" accept="image/*" capture="environment" />
        <button id="btnFromImg" class="ghost">ì‚¬ì§„ì—ì„œ ì¸ì‹(ë°”ì½”ë“œ+ë¬¸ì)</button>
      </div>
      <div class="preview"><img id="imgPrev" class="imgprev" alt=""></div>

      <div class="grid">
        <div class="kv"><div class="k">ì˜ˆìƒ ìƒ‰ìƒ</div><input id="outColor" readonly placeholder="ìë™ ê°ì§€ ì¤‘â€¦"/></div>
        <div class="kv"><div class="k">ëª¨ë¸/í‚¤ì›Œë“œ í›„ë³´</div>
          <div>
            <div id="kwList" class="chips"></div>
            <div class="row" style="margin-top:8px">
              <button class="ghost" id="copyKeywords">í‚¤ì›Œë“œ ë³µì‚¬</button>
              <button class="ghost" id="clearKeywords">ì§€ìš°ê¸°</button>
            </div>
          </div>
        </div>
        <small class="help">Tip: ë¼ë²¨Â·ëª¨ë¸ëª…Â·ìŠ¤í™ì´ ì •ë©´ì— ë³´ì´ë„ë¡ ì°ìœ¼ë©´ ì¸ì‹ë¥ ì´ ì˜¬ë¼ê°€ìš”.</small>
      </div>
    </section>

    <!-- 3) ê°€ê²© ë¹ ë¥¸ ì¡°íšŒ ë§í¬ -->
    <section class="card grid">
      <div class="row">
        <button id="btnNaver" class="ghost">ë„¤ì´ë²„ ì¤‘ê³ ê°€ ê²€ìƒ‰</button>
        <button id="btnBunjang" class="ghost">ë²ˆê°œì¥í„° ê²€ìƒ‰</button>
        <button id="btnEbay" class="ghost">eBay ì‹œì„¸ ê²€ìƒ‰</button>
      </div>
      <small class="help">í˜„ì¬ ì¸ì‹ëœ í‚¤ì›Œë“œ(ë˜ëŠ” ë°”ì½”ë“œ)ë¡œ ìƒˆ íƒ­ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</small>
    </section>

    <!-- 4) íŒë§¤ ê¸€ ìƒì„± -->
    <section class="card grid">
      <div class="grid">
        <label>ë©”ëª¨/êµ¬ì„±í’ˆ/ìƒíƒœ</label>
        <textarea id="memo" placeholder="ì˜ˆ) ì‚¬ìš©ê° ë³´í†µ, ì¼€ì´ë¸” í¬í•¨, í…ŒìŠ¤íŠ¸ ì™„ë£Œ, ì´ˆê¸°í™” ì™„ë£Œ ë“±"></textarea>
      </div>
      <div class="row">
        <button id="btnMakeKorean">ë²ˆê°œì¥í„° íŒë§¤ê¸€ ìƒì„±</button>
        <button class="secondary" id="btnMakeEbay">eBay íƒ€ì´í‹€ ìƒì„±</button>
      </div>
      <div class="grid">
        <label>KR ì œëª©</label>
        <input id="outKRTitle" />
        <label>KR ë³¸ë¬¸</label>
        <textarea id="outKRBody"></textarea>
        <label>EN Title</label>
        <input id="outENTitle" />
        <div class="row">
          <button class="ghost" data-copy="#outKRTitle">KR ì œëª© ë³µì‚¬</button>
          <button class="ghost" data-copy="#outKRBody">KR ë³¸ë¬¸ ë³µì‚¬</button>
          <button class="ghost" data-copy="#outENTitle">EN Title ë³µì‚¬</button>
        </div>
      </div>
    </section>

    <p class="help">Â© MSTECH Â· ëª¨ë“  ì²˜ë¦¬ëŠ” ë¡œì»¬ì—ì„œ ìˆ˜í–‰(ê°œì¸ì •ë³´/ì‚¬ì§„ ì„œë²„ ì „ì†¡ ì—†ìŒ)</p>
  </div>

<script>
/* ----------------------- ê³µí†µ ìœ í‹¸ ----------------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const setText = (el, txt) => { el.textContent = txt };
const copyText = (txt) => navigator.clipboard?.writeText(txt||'');
const sanitize = s => (s||'').replace(/\s+/g,' ').trim();
const uniq = arr => [...new Set(arr.filter(Boolean))];
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function avgColor(img){
  try{
    const c=document.createElement('canvas'),x=c.getContext('2d');
    const w = c.width = Math.min(320, img.naturalWidth||img.videoWidth||320);
    const h = c.height= Math.min(240, img.naturalHeight||img.videoHeight||240);
    x.drawImage(img,0,0,w,h);
    const d = x.getImageData(0,0,w,h).data; let r=0,g=0,b=0, n=0;
    for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];n++}
    r=Math.round(r/n); g=Math.round(g/n); b=Math.round(b/n);
    function toName(r,g,b){
      // ë§¤ìš° ë¼ì´íŠ¸í•œ ìƒ‰ìƒ ì´ë¦„ ë§¤í•‘(ê°„ë‹¨)
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      const l=(max+min)/2;
      if(l<35) return 'Black/Dark';
      if(l>220) return 'White';
      if(r>g&&r>b) return 'Red';
      if(g>r&&g>b) return 'Green';
      if(b>r&&b>g) return 'Blue';
      if(r>200&&g>200) return 'Yellow';
      return 'Gray/Silver';
    }
    return {rgb:`rgb(${r},${g},${b})`, name:toName(r,g,b)};
  }catch(e){return {rgb:'',name:'Unknown'}}
}
function buildQuery(){
  const kws = getKeywords().slice(0,6).join(' ');
  return sanitize(kws || $('#outBarcode').value);
}
function openSearch(base){
  const q = encodeURIComponent(buildQuery());
  window.open(base+q,'_blank');
}
function getKeywords(){
  return $$('#kwList .chip').map(x=>x.textContent.trim());
}
function setKeywords(list){
  const box = $('#kwList'); box.innerHTML='';
  uniq(list).slice(0,20).forEach(w=>{
    const s=document.createElement('span'); s.className='chip'; s.textContent=w;
    s.title='í´ë¦­í•˜ë©´ ì‚­ì œ'; s.onclick=()=>s.remove();
    box.appendChild(s);
  });
}

/* ----------------------- 1) ë¼ì´ë¸Œ ë°”ì½”ë“œ ----------------------- */
const videoEl  = $('#video');
const outBarcode = $('#outBarcode');

async function startScan(){
  try{
    setText($('#statusCam'), 'ì¹´ë©”ë¼ ì´ˆê¸°í™” ì¤‘â€¦');
    await Quagga.init({
      inputStream:{
        name:"Live", type:"LiveStream", target:videoEl,
        constraints:{facingMode:"environment", width:{ideal:1920}, height:{ideal:1080}}
      },
      locator:{patchSize:"large", halfSample:false},
      numOfWorkers:0, frequency:5,
      decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
      locate:true
    }, err=>{ if(err){ alert("ì¹´ë©”ë¼ ì‹¤íŒ¨: "+err); return } Quagga.start(); setText($('#statusCam'),'ìŠ¤ìº” ì¤‘â€¦ ë°”ì½”ë“œë¥¼ í”„ë ˆì„ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”') });

    Quagga.offDetected();
    Quagga.onDetected(res=>{
      const code = res?.codeResult?.code;
      if(!code) return;
      outBarcode.value = code;
      setText($('#statusCam'), 'ì¸ì‹í•¨: '+code);
      // ì—°ì† ì¤‘ë³µ ë°©ì§€
      Quagga.pause(); setTimeout(()=>{try{Quagga.start()}catch(_){}} ,800);
      // ë°”ì½”ë“œ ìˆ«ìë„ í‚¤ì›Œë“œë¡œ ì¶”ê°€
      setKeywords(uniq([code, ...getKeywords()]));
    })
  }catch(e){
    alert('ìŠ¤ìº” ì‹œì‘ ì˜¤ë¥˜: '+e);
  }
}
function stopScan(){ try{Quagga.stop()}catch(_){ } setText($('#statusCam'), 'ì •ì§€ë¨'); }

$('#btnStart').onclick = startScan;
$('#btnStop').onclick  = stopScan;
$('#copyBarcode').onclick = ()=>copyText(outBarcode.value);

/* ----------------------- 2) ì‚¬ì§„ì—ì„œ ì¸ì‹ ----------------------- */
const imgPrev = $('#imgPrev');
$('#imgFile').onchange = async (e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  imgPrev.src = URL.createObjectURL(f);
  await sleep(100);
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
}

$('#btnFromImg').onclick = async ()=>{
  if(!imgPrev.src){ alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒ/ì´¬ì˜í•˜ì„¸ìš”'); return }
  // 2-1) ì •ì§€í™”ìƒ ë°”ì½”ë“œ
  setText($('#statusCam'),'ì‚¬ì§„ ë°”ì½”ë“œ ë¶„ì„ ì¤‘â€¦');
  try{
    await new Promise((resolve)=>{
      Quagga.decodeSingle({
        src: imgPrev.src,
        numOfWorkers:0,
        inputStream:{size:800},
        decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
        locate:true
      }, (res)=>{
        const code = res && res.codeResult && res.codeResult.code;
        if(code){ outBarcode.value = code; setKeywords(uniq([code, ...getKeywords()])); }
        resolve();
      });
    });
  }catch(_){/* ë¬´ì‹œ */}

  // 2-2) OCR (ë¼ë²¨ í…ìŠ¤íŠ¸ â†’ ëª¨ë¸/ë¶€í’ˆë²ˆí˜¸ í›„ë³´ ë½‘ê¸°)
  setText($('#statusCam'),'OCR ì¸ì‹ ì¤‘â€¦');
  try{
    const o = await Tesseract.recognize(imgPrev.src, 'eng', { logger: m=>{/* console.log(m) */} });
    const raw = (o.data?.text||'')
      .replace(/[|]/g,'I').replace(/[^\w\-\s./]/g,' ')
      .split(/\s+/).map(s=>s.trim()).filter(Boolean);

    // ëª¨ë¸/ë¶€í’ˆ ë²ˆí˜¸ì²˜ëŸ¼ ë³´ì´ëŠ” íŒ¨í„´
    const modelish = raw.filter(w=>{
      if(w.length<4) return false;
      if(/^\d{4,}$/.test(w)) return false; // ìˆœìˆ˜ ìˆ«ì ì œì™¸(ë°”ì½”ë“œë‘ ì¤‘ë³µ)
      return /[A-Z].*\d|\d.*[A-Z]/.test(w); // ì˜ë¬¸+ìˆ«ì í˜¼ìš©
    });

    // ìƒí‘œ/ì¼ë°˜ë‹¨ì–´ëŠ” ê°€ë³ê²Œ í•„í„°ë§
    const blacklist = ['SERIAL','MODEL','MADE','DATE','VOID','WARRANTY','LABEL','REMOVED','BROKEN','CERTIFIED','ENTERPRISE','PLUS','BY','THE','AND','WITH','FOR','OF'];
    const cleaned = modelish
      .map(w=>w.replace(/[().,:;'"`]/g,'').toUpperCase())
      .filter(w=>w.length<=24 && !blacklist.includes(w));

    // ìµœì¢… í‚¤ì›Œë“œ í›„ë³´ ì„¸íŒ…
    setKeywords(uniq([ ...cleaned.slice(0,12), outBarcode.value || '' ]));
    setText($('#statusCam'),'ì‚¬ì§„ ì¸ì‹ ì™„ë£Œ');
  }catch(e){
    setText($('#statusCam'),'OCR ì‹¤íŒ¨'); console.warn(e);
  }

  // 2-3) ìƒ‰ìƒ ì¶”ì •(ì´ë¯¸ ì„ íƒ ì‹œ í‰ê· ìƒ‰ ê³„ì‚°)
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
};

$('#copyKeywords').onclick = ()=>{
  copyText(getKeywords().join(' '));
};
$('#clearKeywords').onclick = ()=> setKeywords([]);

/* ----------------------- 3) ë¹ ë¥¸ ê²€ìƒ‰ ë§í¬ ----------------------- */
$('#btnNaver').onclick   = ()=>openSearch('https://search.shopping.naver.com/search/all?query=');
$('#btnBunjang').onclick = ()=>openSearch('https://m.bunjang.co.kr/search/products?q=');
$('#btnEbay').onclick    = ()=>openSearch('https://www.ebay.com/sch/i.html?_nkw=');

/* ----------------------- 4) íŒë§¤ê¸€ ìƒì„± ----------------------- */
function makeTexts(){
  const kws = getKeywords(); const kwLine = kws.join(' ');
  const color = $('#outColor').value || 'Unknown';
  const barcode = $('#outBarcode').value;
  const memo = sanitize($('#memo').value);

  // KR ì œëª© & ë³¸ë¬¸
  const krTitle = sanitize([ kwLine || 'ìƒí’ˆ', color ].join(' | '));
  const krBody =
`âœ… ì œí’ˆ ì •ë³´
- ì£¼ìš” í‚¤ì›Œë“œ: ${kwLine || '-'}
- ìƒ‰ìƒ/ì™¸ê´€: ${color}
- ë°”ì½”ë“œ: ${barcode || '-'}

âœ… ìƒíƒœ/ë©”ëª¨
${memo || '- ì‚¬ìš©ê°/ìƒíƒœë¥¼ ì ì–´ì£¼ì„¸ìš”'}

ğŸ§ª ê°„ë‹¨ í…ŒìŠ¤íŠ¸ í›„ íŒë§¤í•˜ë©°, ì§ê±°ë˜/íƒë°° ë‘˜ ë‹¤ ê°€ëŠ¥í•´ìš”.
ë¬¸ì˜ ì£¼ì‹œë©´ ì‹¤ì‚¬ì§„/ì¶”ê°€ì •ë³´ ë°”ë¡œ ë“œë¦½ë‹ˆë‹¤.`;

  // EN Title (eBay)
  const enTitle = sanitize((kwLine || 'Item') + (color ? ` ${color}` : '')).slice(0,80);

  return {krTitle, krBody, enTitle}
}

$('#btnMakeKorean').onclick = ()=>{
  const {krTitle, krBody} = makeTexts();
  $('#outKRTitle').value = krTitle;
  $('#outKRBody').value  = krBody;
};
$('#btnMakeEbay').onclick = ()=>{
  const {enTitle} = makeTexts();
  $('#outENTitle').value = enTitle;
};

$$('button[data-copy]').forEach(btn=>{
  btn.onclick=()=>{
    const sel = btn.getAttribute('data-copy');
    const v = $(sel)?.value || '';
    copyText(v);
    btn.textContent='ë³µì‚¬ë¨';
    setTimeout(()=>btn.textContent='ë³µì‚¬',900);
  }
});
</script>
</body>
</html>
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MSTECH ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€ - ìµœì¢…</title>
<!-- Quagga2 (ë°”ì½”ë“œ) & Tesseract (OCR) CDN -->
<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>
<script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
<style>
  :root{
    --bg:#0f1115;--card:#151924;--ink:#e8eef7;--muted:#9db0c9;--accent:#28dec4;--accent-ink:#0b2530;
    --danger:#ff5d6c;--ok:#56e39f;--yellow:#ffd166;--border:#202637
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale
  }
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  h1{font-size:28px;margin:0 0 18px;letter-spacing:.2px}
  .brand{font-weight:800}
  .grid{display:grid;gap:14px}
  .card{
    background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 14px 16px
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button, .btn{
    background:var(--accent);color:#012; border:0;border-radius:12px;padding:12px 16px;
    font-weight:700;cursor:pointer;transition:.15s;display:inline-flex;gap:8px;align-items:center
  }
  button.secondary{background:#213043;color:var(--ink)}
  button.ghost{background:#111826;border:1px solid var(--border);color:var(--ink)}
  button:disabled{opacity:.55;cursor:not-allowed}
  input[type="text"],input[type="number"],textarea{
    width:100%;background:#0b1220;border:1px solid var(--border);border-radius:12px;
    padding:12px 12px;color:var(--ink);font-size:15px;outline:none
  }
  textarea{min-height:120px;resize:vertical}
  .help{color:var(--muted);font-size:13px}
  .pill{display:inline-block;background:#0e1b2a;border:1px solid var(--border);color:var(--ink);padding:6px 10px;border-radius:999px;font-size:13px;margin:4px 6px 0 0}
  .preview{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid var(--border)}
  video,canvas,.imgprev{width:100%;height:100%;object-fit:cover;display:block}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:8px;margin-top:8px}
  .kv .k{color:var(--muted)}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{background:#0e1a28;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
  .copy{background:#0e1a28;border:1px dashed var(--border);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
  .ok{color:var(--ok)} .bad{color:var(--danger)} .warn{color:var(--yellow)}
</style>
</head>
<body>
  <div class="wrap">
    <h1><span class="brand">MSTECH</span> ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€</h1>

    <!-- 1) ë¼ì´ë¸Œ ì¹´ë©”ë¼ ë°”ì½”ë“œ ìŠ¤ìº” -->
    <section class="card grid">
      <div class="row">
        <button id="btnStart"><span>ğŸ“·</span> ì¹´ë©”ë¼ ìŠ¤ìº” ì‹œì‘</button>
        <button class="secondary" id="btnStop">ì •ì§€</button>
        <span class="help" id="camHint">ë°”ì½”ë“œë¥¼ ê°€ë¡œë¡œ ì¤‘ì•™ì— ë‘ê³  20â€“30cm ê±°ë¦¬ì—ì„œ ì ê¹ ê³ ì •</span>
      </div>
      <div class="preview"><video id="video" autoplay playsinline muted></video></div>

      <div class="grid">
        <label>ë°”ì½”ë“œ</label>
        <div class="row" style="gap:8px">
          <input id="outBarcode" class="mono" placeholder="ë°”ì½”ë“œ ìë™ ì…ë ¥" />
          <button class="ghost" id="copyBarcode">ë³µì‚¬</button>
        </div>
        <small class="help" id="statusCam">ëŒ€ê¸° ì¤‘â€¦</small>
      </div>
    </section>

    <!-- 2) ì‚¬ì§„ ì—…ë¡œë“œ/ì´¬ì˜ + ì´ë¯¸ì§€ ê¸°ë°˜ ì¸ì‹(ë°”ì½”ë“œ & OCR & ìƒ‰ìƒ)  -->
    <section class="card grid">
      <div class="row">
        <input type="file" id="imgFile" accept="image/*" capture="environment" />
        <button id="btnFromImg" class="ghost">ì‚¬ì§„ì—ì„œ ì¸ì‹(ë°”ì½”ë“œ+ë¬¸ì)</button>
      </div>
      <div class="preview"><img id="imgPrev" class="imgprev" alt=""></div>

      <div class="grid">
        <div class="kv"><div class="k">ì˜ˆìƒ ìƒ‰ìƒ</div><input id="outColor" readonly placeholder="ìë™ ê°ì§€ ì¤‘â€¦"/></div>
        <div class="kv"><div class="k">ëª¨ë¸/í‚¤ì›Œë“œ í›„ë³´</div>
          <div>
            <div id="kwList" class="chips"></div>
            <div class="row" style="margin-top:8px">
              <button class="ghost" id="copyKeywords">í‚¤ì›Œë“œ ë³µì‚¬</button>
              <button class="ghost" id="clearKeywords">ì§€ìš°ê¸°</button>
            </div>
          </div>
        </div>
        <small class="help">Tip: ë¼ë²¨Â·ëª¨ë¸ëª…Â·ìŠ¤í™ì´ ì •ë©´ì— ë³´ì´ë„ë¡ ì°ìœ¼ë©´ ì¸ì‹ë¥ ì´ ì˜¬ë¼ê°€ìš”.</small>
      </div>
    </section>

    <!-- 3) ê°€ê²© ë¹ ë¥¸ ì¡°íšŒ ë§í¬ -->
    <section class="card grid">
      <div class="row">
        <button id="btnNaver" class="ghost">ë„¤ì´ë²„ ì¤‘ê³ ê°€ ê²€ìƒ‰</button>
        <button id="btnBunjang" class="ghost">ë²ˆê°œì¥í„° ê²€ìƒ‰</button>
        <button id="btnEbay" class="ghost">eBay ì‹œì„¸ ê²€ìƒ‰</button>
      </div>
      <small class="help">í˜„ì¬ ì¸ì‹ëœ í‚¤ì›Œë“œ(ë˜ëŠ” ë°”ì½”ë“œ)ë¡œ ìƒˆ íƒ­ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</small>
    </section>

    <!-- 4) íŒë§¤ ê¸€ ìƒì„± -->
    <section class="card grid">
      <div class="grid">
        <label>ë©”ëª¨/êµ¬ì„±í’ˆ/ìƒíƒœ</label>
        <textarea id="memo" placeholder="ì˜ˆ) ì‚¬ìš©ê° ë³´í†µ, ì¼€ì´ë¸” í¬í•¨, í…ŒìŠ¤íŠ¸ ì™„ë£Œ, ì´ˆê¸°í™” ì™„ë£Œ ë“±"></textarea>
      </div>
      <div class="row">
        <button id="btnMakeKorean">ë²ˆê°œì¥í„° íŒë§¤ê¸€ ìƒì„±</button>
        <button class="secondary" id="btnMakeEbay">eBay íƒ€ì´í‹€ ìƒì„±</button>
      </div>
      <div class="grid">
        <label>KR ì œëª©</label>
        <input id="outKRTitle" />
        <label>KR ë³¸ë¬¸</label>
        <textarea id="outKRBody"></textarea>
        <label>EN Title</label>
        <input id="outENTitle" />
        <div class="row">
          <button class="ghost" data-copy="#outKRTitle">KR ì œëª© ë³µì‚¬</button>
          <button class="ghost" data-copy="#outKRBody">KR ë³¸ë¬¸ ë³µì‚¬</button>
          <button class="ghost" data-copy="#outENTitle">EN Title ë³µì‚¬</button>
        </div>
      </div>
    </section>

    <p class="help">Â© MSTECH Â· ëª¨ë“  ì²˜ë¦¬ëŠ” ë¡œì»¬ì—ì„œ ìˆ˜í–‰(ê°œì¸ì •ë³´/ì‚¬ì§„ ì„œë²„ ì „ì†¡ ì—†ìŒ)</p>
  </div>

<script>
/* ----------------------- ê³µí†µ ìœ í‹¸ ----------------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const setText = (el, txt) => { el.textContent = txt };
const copyText = (txt) => navigator.clipboard?.writeText(txt||'');
const sanitize = s => (s||'').replace(/\s+/g,' ').trim();
const uniq = arr => [...new Set(arr.filter(Boolean))];
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function avgColor(img){
  try{
    const c=document.createElement('canvas'),x=c.getContext('2d');
    const w = c.width = Math.min(320, img.naturalWidth||img.videoWidth||320);
    const h = c.height= Math.min(240, img.naturalHeight||img.videoHeight||240);
    x.drawImage(img,0,0,w,h);
    const d = x.getImageData(0,0,w,h).data; let r=0,g=0,b=0, n=0;
    for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];n++}
    r=Math.round(r/n); g=Math.round(g/n); b=Math.round(b/n);
    function toName(r,g,b){
      // ë§¤ìš° ë¼ì´íŠ¸í•œ ìƒ‰ìƒ ì´ë¦„ ë§¤í•‘(ê°„ë‹¨)
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      const l=(max+min)/2;
      if(l<35) return 'Black/Dark';
      if(l>220) return 'White';
      if(r>g&&r>b) return 'Red';
      if(g>r&&g>b) return 'Green';
      if(b>r&&b>g) return 'Blue';
      if(r>200&&g>200) return 'Yellow';
      return 'Gray/Silver';
    }
    return {rgb:`rgb(${r},${g},${b})`, name:toName(r,g,b)};
  }catch(e){return {rgb:'',name:'Unknown'}}
}
function buildQuery(){
  const kws = getKeywords().slice(0,6).join(' ');
  return sanitize(kws || $('#outBarcode').value);
}
function openSearch(base){
  const q = encodeURIComponent(buildQuery());
  window.open(base+q,'_blank');
}
function getKeywords(){
  return $$('#kwList .chip').map(x=>x.textContent.trim());
}
function setKeywords(list){
  const box = $('#kwList'); box.innerHTML='';
  uniq(list).slice(0,20).forEach(w=>{
    const s=document.createElement('span'); s.className='chip'; s.textContent=w;
    s.title='í´ë¦­í•˜ë©´ ì‚­ì œ'; s.onclick=()=>s.remove();
    box.appendChild(s);
  });
}

/* ----------------------- 1) ë¼ì´ë¸Œ ë°”ì½”ë“œ ----------------------- */
const videoEl  = $('#video');
const outBarcode = $('#outBarcode');

async function startScan(){
  try{
    setText($('#statusCam'), 'ì¹´ë©”ë¼ ì´ˆê¸°í™” ì¤‘â€¦');
    await Quagga.init({
      inputStream:{
        name:"Live", type:"LiveStream", target:videoEl,
        constraints:{facingMode:"environment", width:{ideal:1920}, height:{ideal:1080}}
      },
      locator:{patchSize:"large", halfSample:false},
      numOfWorkers:0, frequency:5,
      decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
      locate:true
    }, err=>{ if(err){ alert("ì¹´ë©”ë¼ ì‹¤íŒ¨: "+err); return } Quagga.start(); setText($('#statusCam'),'ìŠ¤ìº” ì¤‘â€¦ ë°”ì½”ë“œë¥¼ í”„ë ˆì„ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”') });

    Quagga.offDetected();
    Quagga.onDetected(res=>{
      const code = res?.codeResult?.code;
      if(!code) return;
      outBarcode.value = code;
      setText($('#statusCam'), 'ì¸ì‹í•¨: '+code);
      // ì—°ì† ì¤‘ë³µ ë°©ì§€
      Quagga.pause(); setTimeout(()=>{try{Quagga.start()}catch(_){}} ,800);
      // ë°”ì½”ë“œ ìˆ«ìë„ í‚¤ì›Œë“œë¡œ ì¶”ê°€
      setKeywords(uniq([code, ...getKeywords()]));
    })
  }catch(e){
    alert('ìŠ¤ìº” ì‹œì‘ ì˜¤ë¥˜: '+e);
  }
}
function stopScan(){ try{Quagga.stop()}catch(_){ } setText($('#statusCam'), 'ì •ì§€ë¨'); }

$('#btnStart').onclick = startScan;
$('#btnStop').onclick  = stopScan;
$('#copyBarcode').onclick = ()=>copyText(outBarcode.value);

/* ----------------------- 2) ì‚¬ì§„ì—ì„œ ì¸ì‹ ----------------------- */
const imgPrev = $('#imgPrev');
$('#imgFile').onchange = async (e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  imgPrev.src = URL.createObjectURL(f);
  await sleep(100);
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
}

$('#btnFromImg').onclick = async ()=>{
  if(!imgPrev.src){ alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒ/ì´¬ì˜í•˜ì„¸ìš”'); return }
  // 2-1) ì •ì§€í™”ìƒ ë°”ì½”ë“œ
  setText($('#statusCam'),'ì‚¬ì§„ ë°”ì½”ë“œ ë¶„ì„ ì¤‘â€¦');
  try{
    await new Promise((resolve)=>{
      Quagga.decodeSingle({
        src: imgPrev.src,
        numOfWorkers:0,
        inputStream:{size:800},
        decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
        locate:true
      }, (res)=>{
        const code = res && res.codeResult && res.codeResult.code;
        if(code){ outBarcode.value = code; setKeywords(uniq([code, ...getKeywords()])); }
        resolve();
      });
    });
  }catch(_){/* ë¬´ì‹œ */}

  // 2-2) OCR (ë¼ë²¨ í…ìŠ¤íŠ¸ â†’ ëª¨ë¸/ë¶€í’ˆë²ˆí˜¸ í›„ë³´ ë½‘ê¸°)
  setText($('#statusCam'),'OCR ì¸ì‹ ì¤‘â€¦');
  try{
    const o = await Tesseract.recognize(imgPrev.src, 'eng', { logger: m=>{/* console.log(m) */} });
    const raw = (o.data?.text||'')
      .replace(/[|]/g,'I').replace(/[^\w\-\s./]/g,' ')
      .split(/\s+/).map(s=>s.trim()).filter(Boolean);

    // ëª¨ë¸/ë¶€í’ˆ ë²ˆí˜¸ì²˜ëŸ¼ ë³´ì´ëŠ” íŒ¨í„´
    const modelish = raw.filter(w=>{
      if(w.length<4) return false;
      if(/^\d{4,}$/.test(w)) return false; // ìˆœìˆ˜ ìˆ«ì ì œì™¸(ë°”ì½”ë“œë‘ ì¤‘ë³µ)
      return /[A-Z].*\d|\d.*[A-Z]/.test(w); // ì˜ë¬¸+ìˆ«ì í˜¼ìš©
    });

    // ìƒí‘œ/ì¼ë°˜ë‹¨ì–´ëŠ” ê°€ë³ê²Œ í•„í„°ë§
    const blacklist = ['SERIAL','MODEL','MADE','DATE','VOID','WARRANTY','LABEL','REMOVED','BROKEN','CERTIFIED','ENTERPRISE','PLUS','BY','THE','AND','WITH','FOR','OF'];
    const cleaned = modelish
      .map(w=>w.replace(/[().,:;'"`]/g,'').toUpperCase())
      .filter(w=>w.length<=24 && !blacklist.includes(w));

    // ìµœì¢… í‚¤ì›Œë“œ í›„ë³´ ì„¸íŒ…
    setKeywords(uniq([ ...cleaned.slice(0,12), outBarcode.value || '' ]));
    setText($('#statusCam'),'ì‚¬ì§„ ì¸ì‹ ì™„ë£Œ');
  }catch(e){
    setText($('#statusCam'),'OCR ì‹¤íŒ¨'); console.warn(e);
  }

  // 2-3) ìƒ‰ìƒ ì¶”ì •(ì´ë¯¸ ì„ íƒ ì‹œ í‰ê· ìƒ‰ ê³„ì‚°)
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
};

$('#copyKeywords').onclick = ()=>{
  copyText(getKeywords().join(' '));
};
$('#clearKeywords').onclick = ()=> setKeywords([]);

/* ----------------------- 3) ë¹ ë¥¸ ê²€ìƒ‰ ë§í¬ ----------------------- */
$('#btnNaver').onclick   = ()=>openSearch('https://search.shopping.naver.com/search/all?query=');
$('#btnBunjang').onclick = ()=>openSearch('https://m.bunjang.co.kr/search/products?q=');
$('#btnEbay').onclick    = ()=>openSearch('https://www.ebay.com/sch/i.html?_nkw=');

/* ----------------------- 4) íŒë§¤ê¸€ ìƒì„± ----------------------- */
function makeTexts(){
  const kws = getKeywords(); const kwLine = kws.join(' ');
  const color = $('#outColor').value || 'Unknown';
  const barcode = $('#outBarcode').value;
  const memo = sanitize($('#memo').value);

  // KR ì œëª© & ë³¸ë¬¸
  const krTitle = sanitize([ kwLine || 'ìƒí’ˆ', color ].join(' | '));
  const krBody =
`âœ… ì œí’ˆ ì •ë³´
- ì£¼ìš” í‚¤ì›Œë“œ: ${kwLine || '-'}
- ìƒ‰ìƒ/ì™¸ê´€: ${color}
- ë°”ì½”ë“œ: ${barcode || '-'}

âœ… ìƒíƒœ/ë©”ëª¨
${memo || '- ì‚¬ìš©ê°/ìƒíƒœë¥¼ ì ì–´ì£¼ì„¸ìš”'}

ğŸ§ª ê°„ë‹¨ í…ŒìŠ¤íŠ¸ í›„ íŒë§¤í•˜ë©°, ì§ê±°ë˜/íƒë°° ë‘˜ ë‹¤ ê°€ëŠ¥í•´ìš”.
ë¬¸ì˜ ì£¼ì‹œë©´ ì‹¤ì‚¬ì§„/ì¶”ê°€ì •ë³´ ë°”ë¡œ ë“œë¦½ë‹ˆë‹¤.`;

  // EN Title (eBay)
  const enTitle = sanitize((kwLine || 'Item') + (color ? ` ${color}` : '')).slice(0,80);

  return {krTitle, krBody, enTitle}
}

$('#btnMakeKorean').onclick = ()=>{
  const {krTitle, krBody} = makeTexts();
  $('#outKRTitle').value = krTitle;
  $('#outKRBody').value  = krBody;
};
$('#btnMakeEbay').onclick = ()=>{
  const {enTitle} = makeTexts();
  $('#outENTitle').value = enTitle;
};

$$('button[data-copy]').forEach(btn=>{
  btn.onclick=()=>{
    const sel = btn.getAttribute('data-copy');
    const v = $(sel)?.value || '';
    copyText(v);
    btn.textContent='ë³µì‚¬ë¨';
    setTimeout(()=>btn.textContent='ë³µì‚¬',900);
  }
});
</script>
</body>
</html>
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>MSTECH ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€ - ìµœì¢…</title>
<!-- Quagga2 (ë°”ì½”ë“œ) & Tesseract (OCR) CDN -->
<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>
<script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
<style>
  :root{
    --bg:#0f1115;--card:#151924;--ink:#e8eef7;--muted:#9db0c9;--accent:#28dec4;--accent-ink:#0b2530;
    --danger:#ff5d6c;--ok:#56e39f;--yellow:#ffd166;--border:#202637
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale
  }
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  h1{font-size:28px;margin:0 0 18px;letter-spacing:.2px}
  .brand{font-weight:800}
  .grid{display:grid;gap:14px}
  .card{
    background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 14px 16px
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button, .btn{
    background:var(--accent);color:#012; border:0;border-radius:12px;padding:12px 16px;
    font-weight:700;cursor:pointer;transition:.15s;display:inline-flex;gap:8px;align-items:center
  }
  button.secondary{background:#213043;color:var(--ink)}
  button.ghost{background:#111826;border:1px solid var(--border);color:var(--ink)}
  button:disabled{opacity:.55;cursor:not-allowed}
  input[type="text"],input[type="number"],textarea{
    width:100%;background:#0b1220;border:1px solid var(--border);border-radius:12px;
    padding:12px 12px;color:var(--ink);font-size:15px;outline:none
  }
  textarea{min-height:120px;resize:vertical}
  .help{color:var(--muted);font-size:13px}
  .pill{display:inline-block;background:#0e1b2a;border:1px solid var(--border);color:var(--ink);padding:6px 10px;border-radius:999px;font-size:13px;margin:4px 6px 0 0}
  .preview{width:100%;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid var(--border)}
  video,canvas,.imgprev{width:100%;height:100%;object-fit:cover;display:block}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:8px;margin-top:8px}
  .kv .k{color:var(--muted)}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{background:#0e1a28;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
  .copy{background:#0e1a28;border:1px dashed var(--border);padding:6px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
  .ok{color:var(--ok)} .bad{color:var(--danger)} .warn{color:var(--yellow)}
</style>
</head>
<body>
  <div class="wrap">
    <h1><span class="brand">MSTECH</span> ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€</h1>

    <!-- 1) ë¼ì´ë¸Œ ì¹´ë©”ë¼ ë°”ì½”ë“œ ìŠ¤ìº” -->
    <section class="card grid">
      <div class="row">
        <button id="btnStart"><span>ğŸ“·</span> ì¹´ë©”ë¼ ìŠ¤ìº” ì‹œì‘</button>
        <button class="secondary" id="btnStop">ì •ì§€</button>
        <span class="help" id="camHint">ë°”ì½”ë“œë¥¼ ê°€ë¡œë¡œ ì¤‘ì•™ì— ë‘ê³  20â€“30cm ê±°ë¦¬ì—ì„œ ì ê¹ ê³ ì •</span>
      </div>
      <div class="preview"><video id="video" autoplay playsinline muted></video></div>

      <div class="grid">
        <label>ë°”ì½”ë“œ</label>
        <div class="row" style="gap:8px">
          <input id="outBarcode" class="mono" placeholder="ë°”ì½”ë“œ ìë™ ì…ë ¥" />
          <button class="ghost" id="copyBarcode">ë³µì‚¬</button>
        </div>
        <small class="help" id="statusCam">ëŒ€ê¸° ì¤‘â€¦</small>
      </div>
    </section>

    <!-- 2) ì‚¬ì§„ ì—…ë¡œë“œ/ì´¬ì˜ + ì´ë¯¸ì§€ ê¸°ë°˜ ì¸ì‹(ë°”ì½”ë“œ & OCR & ìƒ‰ìƒ)  -->
    <section class="card grid">
      <div class="row">
        <input type="file" id="imgFile" accept="image/*" capture="environment" />
        <button id="btnFromImg" class="ghost">ì‚¬ì§„ì—ì„œ ì¸ì‹(ë°”ì½”ë“œ+ë¬¸ì)</button>
      </div>
      <div class="preview"><img id="imgPrev" class="imgprev" alt=""></div>

      <div class="grid">
        <div class="kv"><div class="k">ì˜ˆìƒ ìƒ‰ìƒ</div><input id="outColor" readonly placeholder="ìë™ ê°ì§€ ì¤‘â€¦"/></div>
        <div class="kv"><div class="k">ëª¨ë¸/í‚¤ì›Œë“œ í›„ë³´</div>
          <div>
            <div id="kwList" class="chips"></div>
            <div class="row" style="margin-top:8px">
              <button class="ghost" id="copyKeywords">í‚¤ì›Œë“œ ë³µì‚¬</button>
              <button class="ghost" id="clearKeywords">ì§€ìš°ê¸°</button>
            </div>
          </div>
        </div>
        <small class="help">Tip: ë¼ë²¨Â·ëª¨ë¸ëª…Â·ìŠ¤í™ì´ ì •ë©´ì— ë³´ì´ë„ë¡ ì°ìœ¼ë©´ ì¸ì‹ë¥ ì´ ì˜¬ë¼ê°€ìš”.</small>
      </div>
    </section>

    <!-- 3) ê°€ê²© ë¹ ë¥¸ ì¡°íšŒ ë§í¬ -->
    <section class="card grid">
      <div class="row">
        <button id="btnNaver" class="ghost">ë„¤ì´ë²„ ì¤‘ê³ ê°€ ê²€ìƒ‰</button>
        <button id="btnBunjang" class="ghost">ë²ˆê°œì¥í„° ê²€ìƒ‰</button>
        <button id="btnEbay" class="ghost">eBay ì‹œì„¸ ê²€ìƒ‰</button>
      </div>
      <small class="help">í˜„ì¬ ì¸ì‹ëœ í‚¤ì›Œë“œ(ë˜ëŠ” ë°”ì½”ë“œ)ë¡œ ìƒˆ íƒ­ì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.</small>
    </section>

    <!-- 4) íŒë§¤ ê¸€ ìƒì„± -->
    <section class="card grid">
      <div class="grid">
        <label>ë©”ëª¨/êµ¬ì„±í’ˆ/ìƒíƒœ</label>
        <textarea id="memo" placeholder="ì˜ˆ) ì‚¬ìš©ê° ë³´í†µ, ì¼€ì´ë¸” í¬í•¨, í…ŒìŠ¤íŠ¸ ì™„ë£Œ, ì´ˆê¸°í™” ì™„ë£Œ ë“±"></textarea>
      </div>
      <div class="row">
        <button id="btnMakeKorean">ë²ˆê°œì¥í„° íŒë§¤ê¸€ ìƒì„±</button>
        <button class="secondary" id="btnMakeEbay">eBay íƒ€ì´í‹€ ìƒì„±</button>
      </div>
      <div class="grid">
        <label>KR ì œëª©</label>
        <input id="outKRTitle" />
        <label>KR ë³¸ë¬¸</label>
        <textarea id="outKRBody"></textarea>
        <label>EN Title</label>
        <input id="outENTitle" />
        <div class="row">
          <button class="ghost" data-copy="#outKRTitle">KR ì œëª© ë³µì‚¬</button>
          <button class="ghost" data-copy="#outKRBody">KR ë³¸ë¬¸ ë³µì‚¬</button>
          <button class="ghost" data-copy="#outENTitle">EN Title ë³µì‚¬</button>
        </div>
      </div>
    </section>

    <p class="help">Â© MSTECH Â· ëª¨ë“  ì²˜ë¦¬ëŠ” ë¡œì»¬ì—ì„œ ìˆ˜í–‰(ê°œì¸ì •ë³´/ì‚¬ì§„ ì„œë²„ ì „ì†¡ ì—†ìŒ)</p>
  </div>

<script>
/* ----------------------- ê³µí†µ ìœ í‹¸ ----------------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const setText = (el, txt) => { el.textContent = txt };
const copyText = (txt) => navigator.clipboard?.writeText(txt||'');
const sanitize = s => (s||'').replace(/\s+/g,' ').trim();
const uniq = arr => [...new Set(arr.filter(Boolean))];
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function avgColor(img){
  try{
    const c=document.createElement('canvas'),x=c.getContext('2d');
    const w = c.width = Math.min(320, img.naturalWidth||img.videoWidth||320);
    const h = c.height= Math.min(240, img.naturalHeight||img.videoHeight||240);
    x.drawImage(img,0,0,w,h);
    const d = x.getImageData(0,0,w,h).data; let r=0,g=0,b=0, n=0;
    for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];n++}
    r=Math.round(r/n); g=Math.round(g/n); b=Math.round(b/n);
    function toName(r,g,b){
      // ë§¤ìš° ë¼ì´íŠ¸í•œ ìƒ‰ìƒ ì´ë¦„ ë§¤í•‘(ê°„ë‹¨)
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      const l=(max+min)/2;
      if(l<35) return 'Black/Dark';
      if(l>220) return 'White';
      if(r>g&&r>b) return 'Red';
      if(g>r&&g>b) return 'Green';
      if(b>r&&b>g) return 'Blue';
      if(r>200&&g>200) return 'Yellow';
      return 'Gray/Silver';
    }
    return {rgb:`rgb(${r},${g},${b})`, name:toName(r,g,b)};
  }catch(e){return {rgb:'',name:'Unknown'}}
}
function buildQuery(){
  const kws = getKeywords().slice(0,6).join(' ');
  return sanitize(kws || $('#outBarcode').value);
}
function openSearch(base){
  const q = encodeURIComponent(buildQuery());
  window.open(base+q,'_blank');
}
function getKeywords(){
  return $$('#kwList .chip').map(x=>x.textContent.trim());
}
function setKeywords(list){
  const box = $('#kwList'); box.innerHTML='';
  uniq(list).slice(0,20).forEach(w=>{
    const s=document.createElement('span'); s.className='chip'; s.textContent=w;
    s.title='í´ë¦­í•˜ë©´ ì‚­ì œ'; s.onclick=()=>s.remove();
    box.appendChild(s);
  });
}

/* ----------------------- 1) ë¼ì´ë¸Œ ë°”ì½”ë“œ ----------------------- */
const videoEl  = $('#video');
const outBarcode = $('#outBarcode');

async function startScan(){
  try{
    setText($('#statusCam'), 'ì¹´ë©”ë¼ ì´ˆê¸°í™” ì¤‘â€¦');
    await Quagga.init({
      inputStream:{
        name:"Live", type:"LiveStream", target:videoEl,
        constraints:{facingMode:"environment", width:{ideal:1920}, height:{ideal:1080}}
      },
      locator:{patchSize:"large", halfSample:false},
      numOfWorkers:0, frequency:5,
      decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
      locate:true
    }, err=>{ if(err){ alert("ì¹´ë©”ë¼ ì‹¤íŒ¨: "+err); return } Quagga.start(); setText($('#statusCam'),'ìŠ¤ìº” ì¤‘â€¦ ë°”ì½”ë“œë¥¼ í”„ë ˆì„ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”') });

    Quagga.offDetected();
    Quagga.onDetected(res=>{
      const code = res?.codeResult?.code;
      if(!code) return;
      outBarcode.value = code;
      setText($('#statusCam'), 'ì¸ì‹í•¨: '+code);
      // ì—°ì† ì¤‘ë³µ ë°©ì§€
      Quagga.pause(); setTimeout(()=>{try{Quagga.start()}catch(_){}} ,800);
      // ë°”ì½”ë“œ ìˆ«ìë„ í‚¤ì›Œë“œë¡œ ì¶”ê°€
      setKeywords(uniq([code, ...getKeywords()]));
    })
  }catch(e){
    alert('ìŠ¤ìº” ì‹œì‘ ì˜¤ë¥˜: '+e);
  }
}
function stopScan(){ try{Quagga.stop()}catch(_){ } setText($('#statusCam'), 'ì •ì§€ë¨'); }

$('#btnStart').onclick = startScan;
$('#btnStop').onclick  = stopScan;
$('#copyBarcode').onclick = ()=>copyText(outBarcode.value);

/* ----------------------- 2) ì‚¬ì§„ì—ì„œ ì¸ì‹ ----------------------- */
const imgPrev = $('#imgPrev');
$('#imgFile').onchange = async (e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  imgPrev.src = URL.createObjectURL(f);
  await sleep(100);
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
}

$('#btnFromImg').onclick = async ()=>{
  if(!imgPrev.src){ alert('ì‚¬ì§„ì„ ë¨¼ì € ì„ íƒ/ì´¬ì˜í•˜ì„¸ìš”'); return }
  // 2-1) ì •ì§€í™”ìƒ ë°”ì½”ë“œ
  setText($('#statusCam'),'ì‚¬ì§„ ë°”ì½”ë“œ ë¶„ì„ ì¤‘â€¦');
  try{
    await new Promise((resolve)=>{
      Quagga.decodeSingle({
        src: imgPrev.src,
        numOfWorkers:0,
        inputStream:{size:800},
        decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","code_39_reader","upc_reader","upc_e_reader"]},
        locate:true
      }, (res)=>{
        const code = res && res.codeResult && res.codeResult.code;
        if(code){ outBarcode.value = code; setKeywords(uniq([code, ...getKeywords()])); }
        resolve();
      });
    });
  }catch(_){/* ë¬´ì‹œ */}

  // 2-2) OCR (ë¼ë²¨ í…ìŠ¤íŠ¸ â†’ ëª¨ë¸/ë¶€í’ˆë²ˆí˜¸ í›„ë³´ ë½‘ê¸°)
  setText($('#statusCam'),'OCR ì¸ì‹ ì¤‘â€¦');
  try{
    const o = await Tesseract.recognize(imgPrev.src, 'eng', { logger: m=>{/* console.log(m) */} });
    const raw = (o.data?.text||'')
      .replace(/[|]/g,'I').replace(/[^\w\-\s./]/g,' ')
      .split(/\s+/).map(s=>s.trim()).filter(Boolean);

    // ëª¨ë¸/ë¶€í’ˆ ë²ˆí˜¸ì²˜ëŸ¼ ë³´ì´ëŠ” íŒ¨í„´
    const modelish = raw.filter(w=>{
      if(w.length<4) return false;
      if(/^\d{4,}$/.test(w)) return false; // ìˆœìˆ˜ ìˆ«ì ì œì™¸(ë°”ì½”ë“œë‘ ì¤‘ë³µ)
      return /[A-Z].*\d|\d.*[A-Z]/.test(w); // ì˜ë¬¸+ìˆ«ì í˜¼ìš©
    });

    // ìƒí‘œ/ì¼ë°˜ë‹¨ì–´ëŠ” ê°€ë³ê²Œ í•„í„°ë§
    const blacklist = ['SERIAL','MODEL','MADE','DATE','VOID','WARRANTY','LABEL','REMOVED','BROKEN','CERTIFIED','ENTERPRISE','PLUS','BY','THE','AND','WITH','FOR','OF'];
    const cleaned = modelish
      .map(w=>w.replace(/[().,:;'"`]/g,'').toUpperCase())
      .filter(w=>w.length<=24 && !blacklist.includes(w));

    // ìµœì¢… í‚¤ì›Œë“œ í›„ë³´ ì„¸íŒ…
    setKeywords(uniq([ ...cleaned.slice(0,12), outBarcode.value || '' ]));
    setText($('#statusCam'),'ì‚¬ì§„ ì¸ì‹ ì™„ë£Œ');
  }catch(e){
    setText($('#statusCam'),'OCR ì‹¤íŒ¨'); console.warn(e);
  }

  // 2-3) ìƒ‰ìƒ ì¶”ì •(ì´ë¯¸ ì„ íƒ ì‹œ í‰ê· ìƒ‰ ê³„ì‚°)
  const avg = avgColor(imgPrev);
  $('#outColor').value = avg.name + (avg.rgb? ` (${avg.rgb})`:'');
};

$('#copyKeywords').onclick = ()=>{
  copyText(getKeywords().join(' '));
};
$('#clearKeywords').onclick = ()=> setKeywords([]);

/* ----------------------- 3) ë¹ ë¥¸ ê²€ìƒ‰ ë§í¬ ----------------------- */
$('#btnNaver').onclick   = ()=>openSearch('https://search.shopping.naver.com/search/all?query=');
$('#btnBunjang').onclick = ()=>openSearch('https://m.bunjang.co.kr/search/products?q=');
$('#btnEbay').onclick    = ()=>openSearch('https://www.ebay.com/sch/i.html?_nkw=');

/* ----------------------- 4) íŒë§¤ê¸€ ìƒì„± ----------------------- */
function makeTexts(){
  const kws = getKeywords(); const kwLine = kws.join(' ');
  const color = $('#outColor').value || 'Unknown';
  const barcode = $('#outBarcode').value;
  const memo = sanitize($('#memo').value);

  // KR ì œëª© & ë³¸ë¬¸
  const krTitle = sanitize([ kwLine || 'ìƒí’ˆ', color ].join(' | '));
  const krBody =
`âœ… ì œí’ˆ ì •ë³´
- ì£¼ìš” í‚¤ì›Œë“œ: ${kwLine || '-'}
- ìƒ‰ìƒ/ì™¸ê´€: ${color}
- ë°”ì½”ë“œ: ${barcode || '-'}

âœ… ìƒíƒœ/ë©”ëª¨
${memo || '- ì‚¬ìš©ê°/ìƒíƒœë¥¼ ì ì–´ì£¼ì„¸ìš”'}

ğŸ§ª ê°„ë‹¨ í…ŒìŠ¤íŠ¸ í›„ íŒë§¤í•˜ë©°, ì§ê±°ë˜/íƒë°° ë‘˜ ë‹¤ ê°€ëŠ¥í•´ìš”.
ë¬¸ì˜ ì£¼ì‹œë©´ ì‹¤ì‚¬ì§„/ì¶”ê°€ì •ë³´ ë°”ë¡œ ë“œë¦½ë‹ˆë‹¤.`;

  // EN Title (eBay)
  const enTitle = sanitize((kwLine || 'Item') + (color ? ` ${color}` : '')).slice(0,80);

  return {krTitle, krBody, enTitle}
}

$('#btnMakeKorean').onclick = ()=>{
  const {krTitle, krBody} = makeTexts();
  $('#outKRTitle').value = krTitle;
  $('#outKRBody').value  = krBody;
};
$('#btnMakeEbay').onclick = ()=>{
  const {enTitle} = makeTexts();
  $('#outENTitle').value = enTitle;
};

$$('button[data-copy]').forEach(btn=>{
  btn.onclick=()=>{
    const sel = btn.getAttribute('data-copy');
    const v = $(sel)?.value || '';
    copyText(v);
    btn.textContent='ë³µì‚¬ë¨';
    setTimeout(()=>btn.textContent='ë³µì‚¬',900);
  }
});
</script>
</body>
</html>
