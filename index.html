<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>MSTECH ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€ Â· OCR ìš°ì„  v6.0</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0d0f13">
<style>
:root{--bg:#0d0f13; --panel:#141820; --ink:#e8f0ff; --muted:#9db0cc; --pri:#1ed3c6;}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;}
.wrap{max-width:860px; margin:0 auto; padding:20px 14px 80px}
h1{font-size:28px; margin:12px 0 18px;} .badge{padding:4px 8px; border-radius:8px; background:#1b2330; color:#9db0cc; font-size:12px; margin-left:8px}
.panel{background:var(--panel); border:1px solid #222a36; border-radius:16px; padding:14px; margin:14px 0;}
.row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
.btn{border:0; border-radius:12px; padding:14px 16px; font-weight:700; background:var(--pri); color:#042826; cursor:pointer}
.btn.sec{background:#1f2937; color:#e8f0ff} .btn.small{padding:8px 10px; border-radius:10px; font-weight:600}
label.uploader{display:block; width:100%; padding:12px 14px; background:#0f131a; border:1px dashed #2c3647; color:#9db0cc; border-radius:12px; text-align:center; cursor:pointer}
input[type=file]{display:none}
.grid{display:grid; gap:12px} @media (min-width:840px){ .grid.two{grid-template-columns:1fr 1fr} }
.box{background:#0f131a; border:1px solid #202938; border-radius:14px; padding:10px}
canvas, video{width:100%; border-radius:12px; background:#0a0c10}
.input{width:100%; padding:12px; background:#0d1219; border:1px solid #203046; color:#e8f0ff; border-radius:10px; font-size:15px}
.kv{display:grid; grid-template-columns:120px 1fr; gap:8px; align-items:center}
.k{color:#9db0cc} .tags{display:flex; gap:8px; flex-wrap:wrap} .tag{background:#192233; color:#bcd; padding:6px 10px; border-radius:999px; font-size:13px}
.toast{position:fixed; left:50%; transform:translateX(-50%); bottom:18px; background:#10161f; color:#cfe7ff; border:1px solid #243248; padding:10px 14px; border-radius:10px; display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>MSTECH ìƒí’ˆ ì¸ì‹ & íŒë§¤ê¸€ <span class="badge">OCR ìš°ì„  Â· ì˜¤í”„ë¼ì¸ ë™ì‘</span></h1>
  <div class="panel">
    <div class="row">
      <button class="btn" id="btnCam">ğŸ“· ì¹´ë©”ë¼ ìŠ¤ìº” ì‹œì‘</button>
      <button class="btn sec" id="btnStop" disabled>ì •ì§€</button>
    </div>
    <div class="grid two" style="margin-top:10px">
      <div class="box"><video id="video" playsinline muted></video></div>
      <div class="box"><canvas id="frame" height="360"></canvas></div>
    </div>
    <div class="grid two" style="margin-top:10px">
      <label class="uploader"><input type="file" id="file" accept="image/*" capture="environment">ğŸ“ ì‚¬ì§„ ì„ íƒ or ì´¬ì˜í•˜ì—¬ OCR</label>
      <button class="btn sec" id="btnSnap">í˜„ì¬ í”„ë ˆì„ OCR</button>
    </div>
  </div>

  <div class="panel">
    <h3 style="margin:4px 0 8px">ì¸ì‹ ê²°ê³¼</h3>
    <div class="grid two">
      <div class="box kv"><div class="k">ì˜ˆìƒ ìƒ‰ìƒ</div><input class="input" id="colorGuess" readonly placeholder="ìë™ ê°ì§€ ì¤‘..."></div>
      <div class="box kv"><div class="k">ë°”ì½”ë“œ</div><input class="input" id="barcode" placeholder="ìˆì„ ê²½ìš° ìë™/ìˆ˜ë™ ì…ë ¥"></div>
    </div>
    <div class="box" style="margin-top:10px">
      <div class="k">ëª¨ë¸/í‚¤ì›Œë“œ í›„ë³´</div><div class="tags" id="tagBox"></div>
      <textarea class="input" id="rawText" rows="4" placeholder="OCR í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
      <div class="row" style="margin-top:10px">
        <button class="btn small" id="btnCopy">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
        <button class="btn small" id="btnRefine">ëª¨ë¸/í‚¤ì›Œë“œ ì¶”ì¶œ ë‹¤ì‹œ</button>
      </div>
    </div>
    <div class="grid two" style="margin-top:10px">
      <button class="btn" id="btnSearch">ì‹¤ê±°ë˜ê°€ ìë™ ì¡°íšŒ(ì¶”ì²œ)</button>
      <button class="btn sec" id="btnTitle">eBay Title ìë™ ìƒì„±</button>
    </div>
  </div>

  <div class="panel">
    <h3 style="margin:4px 0 8px">íŒë§¤ ê¸€ ìƒì„±</h3>
    <div class="grid two">
      <textarea class="input" id="krTitle" rows="2" placeholder="KR ì œëª©"></textarea>
      <textarea class="input" id="enTitle" rows="2" placeholder="EN Title"></textarea>
    </div>
    <div class="grid two" style="margin-top:10px">
      <textarea class="input" id="krDesc" rows="6" placeholder="KR ë³¸ë¬¸"></textarea>
      <textarea class="input" id="enDesc" rows="6" placeholder="EN Description"></textarea>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn small" id="btnGen">ìë™ ìƒì„±</button>
      <button class="btn small" id="btnCopyKR">KR ë³µì‚¬</button>
      <button class="btn small" id="btnCopyEN">EN ë³µì‚¬</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
<script>
if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); }
const video=document.getElementById('video'), canvas=document.getElementById('frame'), ctx=canvas.getContext('2d');
const colorGuess=document.getElementById('colorGuess'), barcodeInput=document.getElementById('barcode'), tagBox=document.getElementById('tagBox'), rawText=document.getElementById('rawText');
let stream=null, rafId=null, scanning=false;
function toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500) }
async function startCam(){
  try{ stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false}); video.srcObject=stream; await video.play(); scanning=true; document.getElementById('btnStop').disabled=false; loop();
  }catch(e){ console.error(e); toast('ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'); }
}
function stopCam(){ scanning=false; document.getElementById('btnStop').disabled=true; if(rafId) cancelAnimationFrame(rafId); if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null;}}
document.getElementById('btnCam').onclick=startCam; document.getElementById('btnStop').onclick=stopCam;
function loop(){ if(!scanning) return; const w=canvas.clientWidth||640, h=Math.round(w*3/4); canvas.width=w; canvas.height=h; ctx.drawImage(video,0,0,w,h); averageColor(); rafId=requestAnimationFrame(loop); }
function averageColor(){ try{ const im=ctx.getImageData(0,0,canvas.width,canvas.height).data; let r=0,g=0,b=0,c=0; for(let i=0;i<im.length;i+=48){ r+=im[i]; g+=im[i+1]; b+=im[i+2]; c++; } r=Math.round(r/c); g=Math.round(g/c); b=Math.round(b/c); const hex='#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join(''); colorGuess.value=(r>g+40&&r>b+40?'Red':g>r+30&&g>b+20?'Green':b>r+30&&b>g+20?'Blue':'Gray/Silver')+' ('+hex+')'; }catch(e){} }
async function doOCRFromCanvas(){ const blob=await new Promise(res=>canvas.toBlob(res,'image/jpeg',.9)); await runOCRBlob(blob); }
async function runOCRBlob(blob){ toast('OCR ì¤‘â€¦'); const worker=await Tesseract.createWorker('eng+kor'); const {data:{text}}=await worker.recognize(blob); await worker.terminate(); rawText.value=text.trim(); extractKeywords(); tryDecodeBarcodeFromBlob(blob); toast('OCR ì™„ë£Œ'); }
document.getElementById('btnSnap').onclick=doOCRFromCanvas;
document.getElementById('file').addEventListener('change', async (e)=>{ const f=e.target.files?.[0]; if(!f) return; const url=URL.createObjectURL(f); const img=new Image(); img.src=url; await img.decode(); const w=canvas.clientWidth||640, h=Math.round(w*img.height/img.width); canvas.width=w; canvas.height=h; ctx.drawImage(img,0,0,w,h); averageColor(); await runOCRBlob(f); });
function extractKeywords(){ const text=rawText.value; const upper=text.toUpperCase().replace(/[^A-Z0-9\-\_\/\.\s]/g,' '); const parts=upper.split(/\s+/); const tokens=new Set(); const patts=[/[A-Z]{2,}\-?\d{2,}[A-Z]*/g,/[A-Z]{1}\d{3,}[A-Z]{0,2}/g,/\d{3,}[A-Z]{1,3}\d*/g,/ST\d{6,}/g,/WDC|SEAGATE|SAMSUNG|DELL|HP|HITACHI|TOSHIBA|LG|SONY|APPLE|INTEL|AMD|NVIDIA|MICRON|KINGSTON|SANDISK/g,/SAS|SATA|NVME|PCIE|DDR\d|GB|TB|RPM|7\.2K|10K|15K/g]; for(const p of patts){ const m=upper.match(p); if(m) m.forEach(x=>tokens.add(x)); } for(const w of parts){ if(w.length>=2 && w.length<=22 && (/\d/.test(w) || (w.length>=3 && /^[A-Z]+$/.test(w)))) tokens.add(w); } tagBox.innerHTML=''; [...tokens].slice(0,30).forEach(t=>{ const el=document.createElement('span'); el.className='tag'; el.textContent=t; el.onclick=()=>{navigator.clipboard.writeText(t); toast('ë³µì‚¬ë¨')}; tagBox.appendChild(el); }); const top=[...tokens].slice(0,6).join(' '); if(!document.getElementById('krTitle').value) document.getElementById('krTitle').value=top; if(!document.getElementById('enTitle').value) document.getElementById('enTitle').value=top; }
async function tryDecodeBarcodeFromBlob(blob){ const url=URL.createObjectURL(blob); return new Promise((resolve)=>{ Quagga.decodeSingle({ src:url, numOfWorkers:0, inputStream:{size:800}, decoder:{readers:['ean_reader','ean_8_reader','code_128_reader','upc_reader','upc_e_reader']} }, (res)=>{ if(res && res.codeResult){ barcodeInput.value=res.codeResult.code; toast('ë°”ì½”ë“œ ê°ì§€: '+res.codeResult.code); resolve(res.codeResult.code);} else resolve(null); }); }); }
document.getElementById('btnCopy').onclick=()=>{ navigator.clipboard.writeText(rawText.value||''); toast('í…ìŠ¤íŠ¸ ë³µì‚¬ë¨'); };
document.getElementById('btnRefine').onclick=extractKeywords;
document.getElementById('btnSearch').onclick=()=>{ const q=[document.getElementById('krTitle').value, document.getElementById('enTitle').value, ...[...tagBox.querySelectorAll('.tag')].slice(0,6).map(x=>x.textContent), barcodeInput.value].filter(Boolean).join(' '); const links=[`https://m.bunjang.co.kr/search/products?q=${encodeURIComponent(q)}`, `https://m.cafe.naver.com/ArticleSearchList.nhn?search.query=${encodeURIComponent(q)}`, `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(q)}`, `https://www.google.com/search?q=${encodeURIComponent(q)}`]; window.open(links[2],'_blank'); setTimeout(()=>window.open(links[0],'_blank'),200); setTimeout(()=>window.open(links[3],'_blank'),400); };
document.getElementById('btnTitle').onclick=()=>{ const tags=[...tagBox.querySelectorAll('.tag')].map(x=>x.textContent); const brand=tags.find(t=>/(SEAGATE|DELL|WDC|WD|SAMSUNG|HP|LG|SONY|TOSHIBA)/.test(t))||'Generic'; const model=tags.find(t=>/ST\d{6,}|[A-Z]{2,}\-?\d{3,}/.test(t))||''; const cap=tags.find(t=>/(TB|GB|7\.2K|10K|15K)/.test(t))||''; const title=`${brand} ${model} ${cap}`.trim().replace(/\s+/g,' '); document.getElementById('enTitle').value=title||tags.slice(0,5).join(' '); toast('eBay Title ìƒì„± ì™„ë£Œ'); };
document.getElementById('btnGen').onclick=()=>{ const enT=document.getElementById('enTitle').value||'Used item'; const krT=document.getElementById('krTitle').value||'ì¤‘ê³  ìƒí’ˆ'; const color=colorGuess.value||'ë¯¸ìƒ'; const bc=barcodeInput.value||'ì—†ìŒ'; const kws=[...tagBox.querySelectorAll('.tag')].slice(0,12).map(x=>x.textContent).join(', '); document.getElementById('krDesc').value=`${krT}
- í‚¤ì›Œë“œ: ${kws}
- ìƒ‰ìƒ: ${color}
- ë°”ì½”ë“œ: ${bc}
- ìƒíƒœ: ì¤‘ê³ , ì‘ë™ì—¬ë¶€ í˜„ì¥ í™•ì¸ ê¶Œì¥
- êµí™˜/í™˜ë¶ˆ: ë¶ˆê°€(ì¤‘ê³  íŠ¹ì„±)

ì‹¤ì‚¬ì§„ ì°¸ê³  í›„ ë¬¸ì˜ ì£¼ì„¸ìš”.`; document.getElementById('enDesc').value=`${enT}
- Keywords: ${kws}
- Color: ${color}
- Barcode: ${bc}
- Condition: Used. See photos for details.
- No return/exchange.

Feel free to ask any questions.`; };
document.getElementById('btnCopyKR').onclick=()=>{ navigator.clipboard.writeText(document.getElementById('krTitle').value+'\n\n'+document.getElementById('krDesc').value); toast('KR ë³µì‚¬ ì™„ë£Œ'); };
document.getElementById('btnCopyEN').onclick=()=>{ navigator.clipboard.writeText(document.getElementById('enTitle').value+'\n\n'+document.getElementById('enDesc').value); toast('EN ë³µì‚¬ ì™„ë£Œ'); };
</script>
</body></html>
